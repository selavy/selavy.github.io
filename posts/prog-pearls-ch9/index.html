<!doctype html>

<html lang="en-us">

<head>
  <title>c&#39;est la vie</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="Peter Lesslie" />
  <meta name="generator" content="Hugo 0.40.1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="https://selavy.github.io/css/styles.css" />
</head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="https://selavy.github.io/">c&rsquo;est la vie</a>
            </h1>

      <ul id="social-media">
          
        <li><a href="https://github.com/selavy"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a></li>
           
      </ul>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="https://selavy.github.io/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://selavy.github.io/about/">
                <i class="fa-li fa  fa-lg"></i><span>About</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>Programming Pearls: Chapter 9</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2019-02-18T08:30:07-08:00">Feb 18, 2019</time>
        </li>
        
        

        

        <li>3 min read</li>
    </ul>
</aside>
    

    

<p>Problems from Column #9: Code Tuning</p>

<p>Note: I did skip several problems from several columns because I didn&rsquo;t find them particularly useful. Several of the questions here on out are also pretty dated so I&rsquo;m just going to jump around to the ones that I like.</p>

<h1 id="lessons">Lessons</h1>

<ul>
<li>Speed comes from knowing your data and specializing.
** This comes with what can be a huge cost in terms of maintainability. For most programs this speed is only required in a small part of the program.</li>
<li>Profile first.</li>
</ul>

<h1 id="problem-3">Problem #3</h1>

<p>What special properties of the &ldquo;juggling&rdquo; rotation algorithm allowed us to replace the % remainder operator with an <em>if</em> statement, and not a more costly <em>while</em> statement?</p>

<p>We knew that with the given algorithm, the values would remain in the range [0, 2n) so subtracting <em>n</em> would get us back to the range [0, n). Note: if <em>n</em> is a power of 2, then x % n ==&gt; x &amp; (n-1), which likely will be faster than the <em>if</em> statement and subtraction.</p>

<h1 id="problem-6">Problem #6</h1>

<p>C and C++ libraries provide character classification functions such as <em>isdigit</em>, <em>isupper</em>  and <em>islower</em> to determine the types of characters. How would you implement these functions.</p>

<p>1) This is probably more complicated with locales, and I think these functions make actually touch singleton locale data, but I&rsquo;m going to ignore that. It&rsquo;s just interesting if you are using them in a multi-threaded context. 2) For the simple american english ASCII case, we know that these functions only apply to signed 8-bit characters, where the MSB is 0. So I would make a 128 entry lookup table; if the upper bit is set, then return false, other LUT.</p>

<h1 id="problem-7">Problem #7</h1>

<p>Given a very long sequence (say, billions or trillions) or bytes, how would you efficiently count the total number of one bits? (That is how many bits are turned on in the entire sequence?)</p>

<p>I&rsquo;d build a 512-entry LUT, which would yield code like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Sequence bytes;
uint8_t LUT[<span style="color:#ae81ff">512</span>]; <span style="color:#75715e">// contains # of set bits in each value [0, 512)
</span><span style="color:#75715e"></span>uint64_t count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> N; <span style="color:#f92672">++</span>i) {
    count <span style="color:#f92672">+=</span> LUT[bytes[i]];
}
</code></pre></div>
<h1 id="problem-8">Problem #8</h1>

<p>How can sentinels be used in a program to find the maximum element in an array?</p>

<p>We can avoid the i &lt; N, most of the time (for many inputs), if we set the last element to INT_MAX, and only compare to INT_MAX <em>if</em> vs[i] is greater than the current max. This saves comparisons except in the sorted inputs case, where we only added a small amount of overhead.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">find_max</span>(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> vs) {
    <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> vs.size();
    <span style="color:#66d9ef">int</span> hold <span style="color:#f92672">=</span> vs[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
    vs[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> INT_MAX;
    <span style="color:#66d9ef">int</span> result <span style="color:#f92672">=</span> INT_MIN;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; ; <span style="color:#f92672">++</span>i) {
        assert(i <span style="color:#f92672">&lt;</span> N <span style="color:#f92672">&amp;&amp;</span> <span style="color:#e6db74">&#34;sentinel failed!&#34;</span>);
        <span style="color:#66d9ef">if</span> (vs[i] <span style="color:#f92672">&gt;</span> result) {
            <span style="color:#66d9ef">if</span> (vs[i] <span style="color:#f92672">==</span> INT_MAX) {
                <span style="color:#66d9ef">break</span>;
            }
            result <span style="color:#f92672">=</span> vs[i];
        }
    }
    <span style="color:#66d9ef">if</span> (hold <span style="color:#f92672">&gt;</span> result) {
        result <span style="color:#f92672">=</span> hold;
    }
    vs[N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> hold;
    <span style="color:#66d9ef">return</span> result;
}
</code></pre></div>
<h1 id="problem-9">Problem #9</h1>

<p>In the early 1960&rsquo;s, Vic Berecz found that most of the time in a simulation program at Sikorsky Aircraft was devoted to computing trigonmetric functions. Further investigation showed that the functions were computed only at integral multiples of five degrees. How did he reduce the run time?</p>

<p>Either cache the results, or make a LUT. You only need 360 / 5 = 72 elements per function.</p>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://selavy.github.io/posts/prog-pearls-ch4/"><i class="fa fa-chevron-circle-left"></i> Programming Pearls: Chapter 4</a>
        </li>
        
        
    </ul>
</section>
    





</main>
    <footer>
        <h6> | 
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="https://selavy.github.io/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="https://selavy.github.io/js/scripts.js"></script>
</body>

</html>